#{extends 'main.html' /}
#{set title:'Home' /}

#{set 'moreHead'}
<script type="text/javascript">

    $(function() {
        $.attrHooks['preserveAspectRatio'] = {
            set: function(elem, value, name) {
                elem.setAttributeNS(null, 'preserveAspectRatio', value + '');
                return value;
            }
        };
        $.attrHooks['viewbox'] = {
            set: function(elem, value, name) {
                elem.setAttributeNS(null, 'viewBox', value + '');
                return value;
            }
        };

        var $allVideos = $("iframe[src^='//www.youtube.com']"),
        $fluidEl = $(".container");
        $allVideos.each(function() {

            $(this)
                    .data('aspectRatio', this.height / this.width)

                // and remove the hard coded width/height
                    .removeAttr('height')
                    .removeAttr('width');

        });

        $(window).resize(function() {
            $allVideos.each(function() {

                var $el = $(this);
                var newWidth = $(this).parent().width();
                $el
                        .width(newWidth)
                        .height(newWidth * $el.data('aspectRatio'));

            });
        }).resize();

        $.get(
                '/public/warEvents/warEvents.12.20141105.json',
                {},
                function (data, textStatus, jqXHR) {
                    var dicMemberRank = {};
                    height = 40;
                    var svg = createSvg('svg');
                    svg.attr({
                        width: '100%',
                        'preserveAspectRatio': "xMinYMin meet",
                        'viewBox': "0 0 800 " + (data.arrayMember.length + 1) * height
                    });


                    for(var i = 0; i < data.arrayMember.length; i++) {
                        dicMemberRank[data.arrayMember[i]] = i;
                    }

                    var dicEnemyRank = {};
                    for(var i = 0; i < data.arrayEnemy.length; i++) {
                        dicEnemyRank[data.arrayEnemy[i]] = i
                    }

                    $.each(data.arrayMember, function (index, value) {
                        svg.append(createSvg("text").attr({
                            'class': 'coc',
                            x: 200,
                            y: (index + 1) * height,
                            fill: '#55f',
                            'text-anchor': "end"
                        }).text(value));
                    });
                    $.each(data.arrayEnemy, function (index, value) {
                        svg.append(createSvg("text").attr({
                            'class': 'coc',
                            x: 600,
                            y: (index + 1) * height,
                            fill: '#f55',
                            'text-anchor': "start"
                        }).text(value));
                    });
                    $.each(data.arrayWarEvent, function (index, value) {
                        svg.append(createSvg("line").addClass('coc').attr({
                            'class': 'warLine' + index,
                            x1: 230,
                            x2: 570,
                            y1: dicMemberRank[value[1]] * height + 35,
                            y2: dicEnemyRank[value[2]] * height + 35
                        }).css({
                            stroke: value[0] == "a" ? "#00f" : "#f00",
                            strokeWidth: (value[4] + 1) * 2,
                            opacity: ((value[3] + 20) / 200)
                        }));
                    });
                    $('.chartBipartite').append(svg);

                    var until = 0;
                    setInterval(function() {
                        until++;
                        if(until > 100)
                            until = 0;

                        for (var i = 0; i < 100; i++) {
                            if (i < until) {
                                $(".warLine" + i).show();
                            }
                            else {
                                $(".warLine" + i).hide();
                            }
                        }
                    }, 500);
                }
        ).error(function (jqXHR, textStatue, httpStatus) {
            alert(jqXHR.responseJSON.message);
        });


    });

    function createSvg(name) {
        return $(document.createElementNS("http://www.w3.org/2000/svg", name));
    }
</script>
<script type="text/html" id="line">
    <line
        class="warLine{{index}}"
        x1="230" y1="{{y1}}"
        x2="570" y2="{{y2}}"
        style="stroke: {{color}}; stroke-width: {{strokeWidth}}px; opacity: {{opacity}};"
        data-scoreGained=""
        />
</script>

#{/set}
<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="#">wururung</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
            *{<form class="navbar-form navbar-right" role="form">}*
                *{<div class="form-group">}*
                    *{<input type="text" placeholder="Email" class="form-control">}*
                *{</div>}*
                *{<div class="form-group">}*
                    *{<input type="password" placeholder="Password" class="form-control">}*
                *{</div>}*
                *{<button type="submit" class="btn btn-success">Sign in</button>}*
            *{</form>}*
        </div><!--/.navbar-collapse -->
    </div>
</nav>


<div class="jumbotron">
    <div class="container">
        <img src="http://supercell-www-content.s3.amazonaws.com/http://supercell-www-content.s3-website-us-east-1.amazonaws.com/201401/cache/images/made/b136aec39c9210cd/clash_of_clans_logo_600_270.png" style="height: 100px; float: right;"/>
        <h2>wururung</h2>
        <p>
            함께 즐긴 시간들의 기록입니다.
        </p>
    </div>
</div>
<div class="whiteAlpha">

<div class="container" style="padding: 10px;">
    <div style="">

    </div>
    <h3>Rules</h3>
    <ul>
        <li>
            매달 5일, 15일, 25일 14시에 클랜전을 시작합니다.
        </li>
        <li>
            클랜전 필참입니다.
        </li>
    </ul>

    <h3>Build Order</h3>
    <ol>
        <li>새로 생긴 건물을 다 짓는다.(금광, 엘릭서 정제소는 선택)</li>
        <li>연구소(Laboratory) 풀업</li>
        <li>집합소(Army Camp) 풀업</li>
        <li>클랜성(Clan Castel) 풀업(레벨3까지만 우선순위가 높지만 레벨 4때부터는 본인 마음...)</li>
        <li>마법제작소(Spell Factory) 풀업</li>
        <li>박격포(Mortar)</li>
        <li>마법사타워(Wizard Tower)</li>
        <li>대공포(Air Defense)</li>
        <li>뇌전탑(Hidden Tesla)</li>
        <li>아처타워(Archer Tower)</li>
        <li>대포(Cannon)</li>
        <li>자원 저장소(Storage), 훈련소(Barrack), 암흑훈련소(Dark Barrack)는 필요에 따라</li>
    </ol>

    <h3>Clan Wars</h3>
    <ul>
        <li>새로 추가된 건물들이 있을 수 있으니 War Base를 꼭 점검해 주세요.</li>
        <li>War Map에서 Town Hall과 Clan Castle은 가장 안전한 위치에 두세요.</li>
        <li>War Map의 자원은 약탈당하더라도 본진 자원이 약탈당하는게 아니고, 아무 피해가 없습니다.</li>
        <li>자신의 순위 근방을 공격해 주세요. 너무 낮은 곳을 공격하면 하위 랭커가 공격할 수가 없습니다.</li>
        <li>아래에서부터 별 획득 위주로 별을 쓸어담아 올라가게 됩니다.</li>
        <li>공격 전에 Dragon을 드릴테니 필히 요청주세요.</li>
        <li>클랜성 병력을 유인하여 처리한 후 공격합니다.</li>
        <li>드래곤은 다른 유닛과 섞는 것 보다 드래곤만 뽑아서 공격하는게 낫습니다.</li>
    </ul>

    <h3>Clan War History</h3>
    <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
        <div class="panel panel-default">
            <div class="panel-heading" role="tab" id="headingOne">
                <div class="panel-title">
                    <a data-toggle="collapse" data-parent="#accordion" href="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                        12차전(2014-11-05) - 勝(60:04) - Chronicle
                    </a>
                </div>
            </div>
            <div id="collapseOne" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingOne">
                <div class="panel-body">
                    <h4 style="text-align: center;">Summary</h4>
                    <div style="text-align: center">
                    참여율 100%, 별 획득 100%.<br/>
                    오랜만의 클랜전이었으나, 상대방의 참여가 저조하여 퍼펙트 게임을 목표로 달린 전쟁. 
                    </div>
                    <h4 style="text-align: center;">War Events</h4>
                    <p style="text-align: center;">
                        파란색은 공격, 붉은색은 방어, 굵기는 별 획득수, 투명도는 파괴율입니다.
                    </p>

                    <span id="scoreMember">
                    </span>

                    <span id="scoreEnemy">
                    </span>
                    <div class="chartBipartite"></div>
                    <div class="row">
                        <div class="col-md-12">
                            <h4 style="text-align: center;">Most Heroic Attack</h4>
                            <h5 style="text-align: center;">Temeraire vs ZaZ187</h5>

                            <iframe width="1280" height="800" src="//www.youtube.com/embed/n9hLIN6Nn_0" frameborder="0" allowfullscreen></iframe>

                        </div>
                        <div class="col-md-12">
                            <h4 style="text-align: center;">Most Heroic Defense</h4>
                            <h5 style="text-align: center;">ZaZ187 vs sinipapa</h5>
                            <iframe width="1280" height="800" src="//www.youtube.com/embed/nM9LY2cajcs" frameborder="0" allowfullscreen></iframe>
                        </div>
                    </div>
                    <div class="row">
                        <div style="height: 50px;"> </div>
                        <h4 style="text-align: center;">Featured Battles</h4>
                        <div class="col-md-6">
                            <h5 style="text-align: center;">xhx hassoun vs silsol</h5>
                            <iframe width="1280" height="800" src="//www.youtube.com/embed/T9WVotT6Gdk" frameborder="0" allowfullscreen></iframe>
                        </div>
                        <div class="col-md-6">
                            <h5 style="text-align: center;">sinipapa vs graytlo91</h5>
                            <iframe width="1280" height="800" src="//www.youtube.com/embed/UEHmYu3xVo8" frameborder="0" allowfullscreen></iframe>
                        </div>
                        <div class="col-md-6">
                            <h5 style="text-align: center;">aha00a vs gettysburg</h5>
                            <iframe width="1280" height="800" src="//www.youtube.com/embed/eCmwfZ9jQh0" frameborder="0" allowfullscreen></iframe>
                        </div>
                        <div class="col-md-6">
                            <h5 style="text-align: center;">aha00a vs mighty warrior</h5>
                            <iframe width="1280" height="800" src="//www.youtube.com/embed/h4oFpRKOWMI" frameborder="0" allowfullscreen></iframe>
                        </div>
                        <div class="col-md-6">
                            <h5 style="text-align: center;">kig1945 vs Al18ex1888</h5>
                            <iframe width="1280" height="800" src="//www.youtube.com/embed/1Na4kB77Vcw" frameborder="0" allowfullscreen></iframe>
                        </div>
                        <div class="col-md-6">
                            <h5 style="text-align: center;">Kang Ill Goo vs tgrubb5</h5>
                            <iframe width="1280" height="800" src="//www.youtube.com/embed/ssnwso4R7nc" frameborder="0" allowfullscreen></iframe>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        %{
            def listHistory = [
                "11차전(2014-10-20) - 勝(64:59) - iran sky",
                "10차전(2014-10-13) - 勝(65:64) - Natsoe Empire",
                "09차전(2014-10-06) - 敗(62:64) - 沙漠之狐",
                "08차전(2014-09-29) - 勝(72:26) - ZHUMABAI CLANS",
                "07차전(2014-09-22) - 勝(70:07) - Winston Rules",
                "06차전(2014-09-15) - 勝(55:25) - T1rd Burglers",
                "05차전(2014-09-08) - 勝(41:15) - SuperNova",
                "04차전(2014-09-01) - 勝(25:12) - 湖里JW",
                "03차전(2014-08-25) - 勝(29:21) - clan Tu Do",
                "02차전(2014-08-18) - 勝(27:12) - TURK'S TEAM",
                "01차전(2014-08-11) - 敗(??:??) - ???"
            ];
        }%
        #{list 0..listHistory.size() - 1}
            <div class="panel panel-default">
                <div class="panel-heading" role="tab" id="heading${_}">
                    <div class="panel-title">
                        <a class="collapsed" data-toggle="collapse" data-parent="#accordion" href="#collapse${_}" aria-expanded="false" aria-controls="collapse${_}">
                            ${listHistory[_]}
                        </a>
                    </div>
                </div>
                <div id="collapse${_}" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading${_}">
                    <div class="panel-body">
                        기록이 소실되었습니다.
                    </div>
                </div>
            </div>
        #{/list}
    </div>

    <h3>Replay</h3>
    %{
        def listReplay = [
            ["라바하운드 2", "//www.youtube.com/embed/2oYAj7tMFkQ"],
            ["그냥 폭탄도 뭉치면 강해요^^", "//www.youtube.com/embed/xQ-3Quzriok"]
        ];
    }%
    #{list 0..listReplay.size() - 1}
        <div class="panel panel-default">
            <div class="panel-heading" role="tab" id="headingReplay${_}">
                <h4 class="panel-title">
                    <a class="collapsed" data-toggle="collapse" data-parent="#accordion" href="#collapseReplay${_}" aria-expanded="false" aria-controls="collapseReplay${_}">
                    ${listReplay[_][0]}
                    </a>
                </h4>
            </div>
            <div id="collapseReplay${_}" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingReplay${_}">
                <div class="panel-body">
                    <iframe width="1280" height="800" src="${listReplay[_][1]}" frameborder="0" allowfullscreen></iframe>
                </div>
            </div>
        </div>
    #{/list}
    <hr/>

    <hr/>
    Contact:
    <a href="http://facebook.com/aha00a">
        <img style="width: 16px; height: 16px; vertical-align: middle;" src="https://fbcdn-profile-a.akamaihd.net/hprofile-ak-xaf1/v/t1.0-1/c12.12.155.155/576889_449528545089056_951742509_n.jpg?oh=30c8be2776e4c1b051b84c63c4e118ab&oe=54EC28AE&__gda__=1425594912_c0022cd343e150b1199404c85e54fad0"/>
        Aha00a
    </a>


</div>
</div>
